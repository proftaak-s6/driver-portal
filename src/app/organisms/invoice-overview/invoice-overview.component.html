<div class="container">
  <h1>Mijn ritten</h1>

  <mat-accordion *ngIf="this.invoices.length > 0">
    <div *ngFor="let invoice of this.invoices">
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            Ritnummer {{ invoice.invoiceNumberString }}
          </mat-panel-title>
          <mat-panel-description>
            {{ invoice.invoiceDate | date:'MMMM yyyy' }}
          </mat-panel-description>
        </mat-expansion-panel-header>

        <mat-accordion>
          <div *ngFor="let vehicleInvoice of invoice.vehicleInvoices">
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>
                  {{ vehicleInvoice.vehicle.displayName }}
                </mat-panel-title>
                <mat-panel-description>
                  {{ vehicleInvoice.vehicle.licensePlate }}
                </mat-panel-description>
              </mat-expansion-panel-header>

              <h3>Regional Invoice Lines</h3>
              <table
                mat-table
                [dataSource]="vehicleInvoice.regionalInvoiceLines"
                class="mat-elevation-z1"
              >
                <ng-container matColumnDef="region">
                  <th mat-header-cell *matHeaderCellDef>Region</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.region }}
                  </td>
                </ng-container>

                <ng-container matColumnDef="registrationMoment">
                  <th mat-header-cell *matHeaderCellDef>registrationMoment</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.registrationMoment | date: "medium" }}
                  </td>
                </ng-container>

                <ng-container matColumnDef="regionalPriceBeforeTaxes">
                  <th mat-header-cell *matHeaderCellDef>
                    regionalPriceBeforeTaxes
                  </th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.regionalPriceBeforeTaxes }}
                  </td>
                </ng-container>

                <ng-container matColumnDef="accountedPriceBeforeTaxes">
                  <th mat-header-cell *matHeaderCellDef>
                    accountedPriceBeforeTaxes
                  </th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.accountedPriceBeforeTaxes }}
                  </td>
                </ng-container>

                <tr
                  mat-header-row
                  *matHeaderRowDef="[
                    'region',
                    'registrationMoment',
                    'regionalPriceBeforeTaxes',
                    'accountedPriceBeforeTaxes'
                  ]"
                ></tr>
                <tr
                  mat-row
                  *matRowDef="
                    let row;
                    columns: [
                      'region',
                      'registrationMoment',
                      'regionalPriceBeforeTaxes',
                      'accountedPriceBeforeTaxes'
                    ]
                  "
                ></tr>
              </table>

              <h3>Kilometer Invoice Lines</h3>
              <table
                mat-table
                [dataSource]="vehicleInvoice.kilometerInvoiceLines"
                class="mat-elevation-z1"
              >
                <ng-container matColumnDef="roadType">
                  <th mat-header-cell *matHeaderCellDef>Roadtype</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.roadType }}
                  </td>
                </ng-container>

                <ng-container matColumnDef="drivenDistanceInMeters">
                  <th mat-header-cell *matHeaderCellDef>
                    Driven distance (m.)
                  </th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.drivenDistanceInMeters }}
                  </td>
                </ng-container>

                <ng-container matColumnDef="pricePerKilometerBeforeTaxes">
                  <th mat-header-cell *matHeaderCellDef>Price per km</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.pricePerKilometerBeforeTaxes }}
                  </td>
                </ng-container>

                <tr
                  mat-header-row
                  *matHeaderRowDef="[
                    'roadType',
                    'drivenDistanceInMeters',
                    'pricePerKilometerBeforeTaxes'
                  ]"
                ></tr>
                <tr
                  mat-row
                  *matRowDef="
                    let row;
                    columns: [
                      'roadType',
                      'drivenDistanceInMeters',
                      'pricePerKilometerBeforeTaxes'
                    ]
                  "
                ></tr>
              </table>
            </mat-expansion-panel>
          </div>
        </mat-accordion>
        <mat-action-row>
            <button
              mat-raised-button
              color="accent"
              (click)="this.getPdf(invoice)"
            >
              Download PDF
            </button>
            <button
              mat-raised-button
              color="primary"
              (click)="this.initiateInvoicePayment(invoice)"
            >
              Pay
            </button>
        </mat-action-row>
      </mat-expansion-panel>
    </div>
  </mat-accordion>
</div>

<div *ngIf="this.invoices.length == 0">
  <mat-spinner></mat-spinner>
</div>
